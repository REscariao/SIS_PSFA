<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Equipes de Trabalho - Sistema Paroquial</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

<header class="navbar">
        <div class="nav-container">
            <a href="dashboard.html" class="logo"><img src="img/logoParoquia.png" width="270" alt="Logo Paróquia"></a>
            <nav>
                <ul class="nav-links">
                    <li><a href="secretaria.html">Secretária</a></li>
                    <li><a href="#"></a></li>
                    <li>
                    <a href="logout.php" class="btn-logout" title="Sair">
                        <i class="fa-solid fa-power-off" style="color: #81693b;"></i>
                    </a>    
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="content">
        <div class="form-card full-width">
            <header class="form-header header-flex">
                <div>
                    <h2>Equipes de Trabalho</h2>
                    <p>Distribuição de tarefas e membros por setor.</p>
                </div>
                <div class="actions">
                    <a href="montar_equipe.html" class="btn btn-secondary" style="text-decoration: none;">+ Nova Equipe</a>
                </div>
            </header>

            <div class="equipe-grid" id="grid-equipes">
                <p style="text-align: center; grid-column: 1/-1;">Carregando equipes...</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2026 - Gestão Paroquial Inteligente</p>
    </footer>

    <script>
        async function renderizarEquipes() {
            try {
                const response = await fetch('api/listar_equipes_detalhado.php');
                const dados = await response.json();
                
                const grid = document.getElementById('grid-equipes');
                grid.innerHTML = '';

                if (dados.length === 0) {
                    grid.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">Nenhuma equipe montada. Clique em + Nova Equipe.</p>';
                    return;
                }

                // Lógica para agrupar os casais por nome da equipe
                const grupos = {};
                dados.forEach(item => {
                    if (!grupos[item.nome_equipe]) grupos[item.nome_equipe] = [];
                    grupos[item.nome_equipe].push(item);
                });

                // Criando o HTML usando exatamente as suas classes
                for (const nomeEquipe in grupos) {
                    const membros = grupos[nomeEquipe];
                    
                    let cardHTML = `
                        <div class="equipe-group">
                            <div class="group-header">
                                <h4>${nomeEquipe}</h4>
                                <span class="count">${membros.length} Casais</span>
                            </div>
                            <ul class="member-list">
                    `;

                    membros.forEach(m => {
                        const isCoord = m.funcao === 'Coordenador';
                        cardHTML += `
                            <li>
                                ${isCoord ? '<strong>' : ''}
                                ${m.ele_nome} e ${m.ela_nome}
                                ${isCoord ? '</strong> (Coord.)' : ''}
                            </li>`;
                    });

                    cardHTML += `
                            </ul>
                            <a href="montar_equipe.html" class="btn-text" style="text-decoration: none; display: block; margin-top: 10px;">
                                + Adicionar Casal
                            </a>
                        </div>`;
                    
                    grid.innerHTML += cardHTML;
                }
            } catch (error) {
                console.error("Erro ao carregar:", error);
                document.getElementById('grid-equipes').innerHTML = 'Erro ao conectar com o banco de dados.';
            }
        }

        renderizarEquipes();
    </script>
</body>
</html>